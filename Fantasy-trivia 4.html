<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Fantasy Draft Trivia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        .position-badge { font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 3px; }
        .qb-badge { background: #3b82f6; color: white; }
        .rb-badge { background: #10b981; color: white; }
        .wr-badge { background: #a855f7; color: white; }
        .te-badge { background: #f97316; color: white; }
        .flex-badge { background: #06b6d4; color: white; }
        .sflex-badge { background: #ec4899; color: white; }
        
        .player-row { background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(71, 85, 105, 0.4); border-radius: 8px; padding: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; position: relative; }
        .autocomplete-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: #1e293b; border: 1px solid #475569; border-radius: 8px; max-height: 200px; overflow-y: auto; z-index: 1000; }
        .autocomplete-item { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #334155; font-size: 13px; }
        .autocomplete-item:hover { background: #334155; }
        input { background: #0f172a; border: 1px solid #334155; color: white; padding: 4px 8px; border-radius: 4px; font-size: 13px; }
    </style>
</head>
<body class="bg-slate-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">üèà NFL FANTASY TRIVIA (2000-2024)</h1>

        <div class="grid grid-cols-3 gap-6 mb-8 text-center">
            <div class="bg-slate-800 p-4 rounded-lg">
                <div class="text-sm text-slate-400">P1 Total</div>
                <div id="total1" class="text-2xl font-bold text-blue-400">0.00</div>
            </div>
            <div class="bg-slate-800 p-4 rounded-lg">
                <div class="text-sm text-slate-400">P2 Total</div>
                <div id="total2" class="text-2xl font-bold text-blue-400">0.00</div>
            </div>
            <div class="bg-slate-800 p-4 rounded-lg">
                <div class="text-sm text-slate-400">P3 Total</div>
                <div id="total3" class="text-2xl font-bold text-blue-400">0.00</div>
            </div>
        </div>

        <div class="grid grid-cols-3 gap-8" id="board"></div>
    </div>

    <script>
        const positions = [
            { id: 'QB', label: 'QB', class: 'qb-badge', filter: ['QB'] },
            { id: 'RB1', label: 'RB', class: 'rb-badge', filter: ['RB'] },
            { id: 'RB2', label: 'RB', class: 'rb-badge', filter: ['RB'] },
            { id: 'WR1', label: 'WR', class: 'wr-badge', filter: ['WR'] },
            { id: 'WR2', label: 'WR', class: 'wr-badge', filter: ['WR'] },
            { id: 'TE', label: 'TE', class: 'te-badge', filter: ['TE'] },
            { id: 'FLEX', label: 'FLEX', class: 'flex-badge', filter: ['RB', 'WR', 'TE'] },
            { id: 'SFLEX', label: 'SFLEX', class: 'sflex-badge', filter: ['QB', 'RB', 'WR', 'TE'] }
        ];

        let seasonalCache = {};
        let gameState = { 1: {}, 2: {}, 3: {} };

        function init() {
            const board = document.getElementById('board');
            for (let p = 1; p <= 3; p++) {
                const col = document.createElement('div');
                positions.forEach(pos => {
                    const row = document.createElement('div');
                    row.className = 'player-row';
                    row.innerHTML = `
                        <span class="position-badge ${pos.class}">${pos.label}</span>
                        <input type="number" placeholder="Year" class="w-16" id="year-${p}-${pos.id}" value="2023">
                        <div class="flex-1 relative">
                            <input type="text" placeholder="Search..." class="w-full" id="search-${p}-${pos.id}" oninput="handleSearch(${p}, '${pos.id}')">
                            <div id="drop-${p}-${pos.id}" class="autocomplete-dropdown hidden"></div>
                        </div>
                        <div id="pts-${p}-${pos.id}" class="w-12 text-right font-mono">0.0</div>
                    `;
                    col.appendChild(row);
                });
                board.appendChild(col);
            }
        }

        async function loadYear(year) {
            if (seasonalCache[year]) return seasonalCache[year];
            return new Promise((resolve) => {
                // IMPORTANT: Ensure your files are named 'player_stats_2023.csv' in the same folder
                Papa.parse(`player_stats_${year}.csv`, {
                    download: true,
                    header: true,
                    complete: (results) => {
                        seasonalCache[year] = results.data;
                        resolve(results.data);
                    },
                    error: () => resolve([])
                });
            });
        }

        async function handleSearch(playerNum, posId) {
            const year = document.getElementById(`year-${playerNum}-${posId}`).value;
            const query = document.getElementById(`search-${playerNum}-${posId}`).value.toLowerCase();
            const dropdown = document.getElementById(`drop-${playerNum}-${posId}`);
            
            if (query.length < 2) { dropdown.classList.add('hidden'); return; }

            const data = await loadYear(year);
            const posConfig = positions.find(p => p.id === posId);
            
            // Filter by name and the specific allowed positions for that slot
            const matches = data.filter(row => 
                row.player_name?.toLowerCase().includes(query) && 
                posConfig.filter.includes(row.position)
            ).slice(0, 6);

            if (matches.length > 0) {
                dropdown.innerHTML = matches.map(m => `
                    <div class="autocomplete-item" onclick="selectPlayer(${playerNum}, '${posId}', '${m.player_name}', ${m.fantasy_points_ppr})">
                        ${m.player_name} (${m.position}) - ${parseFloat(m.fantasy_points_ppr).toFixed(1)} pts
                    </div>
                `).join('');
                dropdown.classList.remove('hidden');
            } else {
                dropdown.classList.add('hidden');
            }
        }

        function selectPlayer(p, posId, name, pts) {
            document.getElementById(`search-${p}-${posId}`).value = name;
            document.getElementById(`pts-${p}-${posId}`).innerText = parseFloat(pts).toFixed(1);
            document.getElementById(`drop-${p}-${posId}`).classList.add('hidden');
            
            gameState[p][posId] = parseFloat(pts);
            updateTotal(p);
        }

        function updateTotal(p) {
            const total = Object.values(gameState[p]).reduce((a, b) => a + b, 0);
            document.getElementById(`total${p}`).innerText = total.toFixed(2);
        }

        window.onclick = () => document.querySelectorAll('.autocomplete-dropdown').forEach(d => d.classList.add('hidden'));
        init();
    </script>
</body>
</html>