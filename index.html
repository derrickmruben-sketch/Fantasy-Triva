<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NFL Fantasy Draft Trivia</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    .position-badge { font-size: 10px; font-weight: bold; padding: 2px 6px; border-radius: 3px; display: inline-block; }
    .qb-badge { background: #3b82f6; color: white; }
    .rb-badge { background: #10b981; color: white; }
    .wr-badge { background: #a855f7; color: white; }
    .te-badge { background: #f97316; color: white; }
    .flex-badge { background: #06b6d4; color: white; }
    .sflex-badge { background: #ec4899; color: white; }
    
    .player-row {
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid rgba(71, 85, 105, 0.4);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      min-height: 48px;
    }
    
    .player-row.selected { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
    .player-row.error { border-color: #ef4444; }
    
    .autocomplete-dropdown {
      position: absolute;
      background: #1e293b;
      border: 1px solid #475569;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      width: 300px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    
    .autocomplete-item { padding: 8px 12px; cursor: pointer; border-bottom: 1px solid #334155; }
    .autocomplete-item:hover { background: #334155; }
    
    input[type="text"], input[type="number"] {
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid #475569;
      border-radius: 4px;
      color: white;
      padding: 6px 10px;
      font-size: 14px;
    }
    
    input[type="text"]:focus, input[type="number"]:focus { outline: none; border-color: #3b82f6; }
    
    .loading-spinner {
      border: 2px solid #475569;
      border-top: 2px solid #3b82f6;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen text-white p-8">
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-2">üèà NFL FANTASY DRAFT TRIVIA</h1>
      <p class="text-slate-400">Pick the best player-year combo for each position ‚Ä¢ Full PPR Scoring</p>
    </div>

    <div class="grid grid-cols-3 gap-6 mb-6">
      <input type="text" id="player1Name" placeholder="Player 1 Name" class="w-full text-lg font-bold text-center" value="Unc" />
      <input type="text" id="player2Name" placeholder="Player 2 Name" class="w-full text-lg font-bold text-center" value="Sexy" />
      <input type="text" id="player3Name" placeholder="Player 3 Name" class="w-full text-lg font-bold text-center" value="Gut" />
    </div>

    <div class="grid grid-cols-3 gap-6 mb-4">
      <div class="bg-slate-800 rounded-lg p-4 text-center border border-slate-700">
        <div class="text-2xl font-bold" id="score1Header">Unc</div>
        <div class="text-3xl font-bold text-blue-400 mt-2" id="total1">0.00</div>
      </div>
      <div class="bg-slate-800 rounded-lg p-4 text-center border border-slate-700">
        <div class="text-2xl font-bold" id="score2Header">Sexy</div>
        <div class="text-3xl font-bold text-blue-400 mt-2" id="total2">0.00</div>
      </div>
      <div class="bg-slate-800 rounded-lg p-4 text-center border border-slate-700">
        <div class="text-2xl font-bold" id="score3Header">Gut</div>
        <div class="text-3xl font-bold text-blue-400 mt-2" id="total3">0.00</div>
      </div>
    </div>

    <div class="grid grid-cols-3 gap-6" id="draftBoard">
      <div id="column1"></div>
      <div id="column2"></div>
      <div id="column3"></div>
    </div>

    <div class="text-center mt-8">
      <button onclick="resetGame()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg">Reset Game</button>
    </div>
  </div>

  <script>
    const positions = [
      { name: 'QB', label: 'QB', class: 'qb-badge' },
      { name: 'RB1', label: 'RB1', class: 'rb-badge' },
      { name: 'RB2', label: 'RB2', class: 'rb-badge' },
      { name: 'WR1', label: 'WR1', class: 'wr-badge' },
      { name: 'WR2', label: 'WR2', class: 'wr-badge' },
      { name: 'TE', label: 'TE', class: 'te-badge' },
      { name: 'FLEX', label: 'FLEX', class: 'flex-badge' },
      { name: 'SFLEX', label: 'SFLEX', class: 'sflex-badge' }
    ];

    let gameState = { column1: {}, column2: {}, column3: {} };
    let seasonalCache = {};

    function initializeBoard() {
      ['column1', 'column2', 'column3'].forEach((colId, colIndex) => {
        const column = document.getElementById(colId);
        column.innerHTML = '';
        positions.forEach(pos => {
          const row = createPlayerRow(pos, colId, colIndex + 1);
          column.appendChild(row);
        });
      });
    }

    function createPlayerRow(position, columnId, playerNum) {
      const row = document.createElement('div');
      row.className = 'player-row';
      row.id = `${columnId}-${position.name}`;
      row.innerHTML = `
        <span class="position-badge ${position.class}">${position.label}</span>
        <div class="flex-1 flex gap-2 items-center">
          <input type="number" placeholder="Year" class="w-20" min="1999" max="2024" id="${columnId}-${position.name}-year" />
          <div class="relative flex-1">
            <input type="text" placeholder="Player name..." class="w-full" id="${columnId}-${position.name}-name" 
                   oninput="handlePlayerSearch('${columnId}', '${position.name}')" />
            <div id="${columnId}-${position.name}-dropdown" class="autocomplete-dropdown hidden"></div>
          </div>
        </div>
        <div class="w-24 text-right"><span id="${columnId}-${position.name}-points" class="text-lg font-bold">-</span></div>
      `;
      return row;
    }

    async function fetchStatsForYear(year) {
      if (seasonalCache[year]) return seasonalCache[year];
      try {
        const response = await fetch(`https://github.com/nflverse/nflverse-data/releases/download/player_stats/player_stats_${year}.csv`);
        if (!response.ok) throw new Error();
        const csvText = await response.text();
        const rows = csvText.split('\n').filter(row => row.trim() !== '');
        const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
        
        const nameIdx = headers.indexOf('player_name');
        const posIdx = headers.indexOf('position');
        const pprIdx = headers.indexOf('fantasy_points_ppr');

        const players = rows.slice(1).map(row => {
          const cols = row.split(',');
          return {
            name: cols[nameIdx]?.replace(/"/g, ''),
            pos: cols[posIdx]?.replace(/"/g, ''),
            points: parseFloat(cols[pprIdx]) || 0
          };
        }).filter(p => p.name);

        seasonalCache[year] = players;
        return players;
      } catch (err) {
        console.error("Year not found or error loading data");
        return [];
      }
    }

    let searchTimeout;
    async function handlePlayerSearch(columnId, positionName) {
      clearTimeout(searchTimeout);
      const nameInput = document.getElementById(`${columnId}-${positionName}-name`);
      const yearInput = document.getElementById(`${columnId}-${positionName}-year`);
      const dropdown = document.getElementById(`${columnId}-${positionName}-dropdown`);
      const searchTerm = nameInput.value.trim().toLowerCase();
      const year = yearInput.value;

      if (!year) { alert("Please enter a year first"); return; }
      if (searchTerm.length < 2) { dropdown.classList.add('hidden'); return; }

      dropdown.innerHTML = '<div class="autocomplete-item">Searching...</div>';
      dropdown.classList.remove('hidden');

      searchTimeout = setTimeout(async () => {
        const players = await fetchStatsForYear(year);
        const filtered = players.filter(p => p.name.toLowerCase().includes(searchTerm)).slice(0, 8);
        
        dropdown.innerHTML = filtered.map(p => `
          <div class="autocomplete-item" onclick="selectPlayer('${columnId}', '${positionName}', '${p.name}', ${p.points})">
            <div class="font-bold">${p.name}</div>
            <div class="text-xs text-slate-400">${p.pos} - ${p.points.toFixed(2)} pts</div>
          </div>
        `).join('') || '<div class="autocomplete-item">No results</div>';
      }, 300);
    }

    function selectPlayer(columnId, positionName, playerName, points) {
      document.getElementById(`${columnId}-${positionName}-name`).value = playerName;
      document.getElementById(`${columnId}-${positionName}-dropdown`).classList.add('hidden');
      document.getElementById(`${columnId}-${positionName}-points`).textContent = points.toFixed(2);
      document.getElementById(`${columnId}-${positionName}`).classList.add('selected');
      
      gameState[columnId][positionName] = points;
      updateColumnTotal(columnId);
    }

    function updateColumnTotal(columnId) {
      const total = Object.values(gameState[columnId]).reduce((a, b) => a + b, 0);
      document.getElementById(`total${columnId.replace('column', '')}`).textContent = total.toFixed(2);
    }

    function resetGame() {
      if (confirm('Reset board?')) {
        gameState = { column1: {}, column2: {}, column3: {} };
        initializeBoard();
        ['1','2','3'].forEach(i => document.getElementById(`total${i}`).textContent = "0.00");
      }
    }

    document.addEventListener('click', (e) => {
      if (!e.target.matches('input')) {
        document.querySelectorAll('.autocomplete-dropdown').forEach(d => d.classList.add('hidden'));
      }
    });

    initializeBoard();
  </script>
</body>
</html>
